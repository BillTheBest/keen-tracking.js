{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","lib/browser.js","lib/helpers/getBrowserProfile.js","lib/helpers/getDatetimeIndex.js","lib/helpers/getDomEventProfile.js","lib/helpers/getDomNodePath.js","lib/helpers/getScreenProfile.js","lib/helpers/getUniqueId.js","lib/helpers/getWindowProfile.js","lib/index.js","lib/record-browser.js","lib/utils/base64.js","lib/utils/each.js","lib/utils/extend.js","lib/utils/parseParams.js","node_modules/component-emitter/index.js"],"names":[],"mappings":"AAAA;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrBA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"keen-tracking.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",";(function (f) {\n  // RequireJS\n  if (typeof define === 'function' && define.amd) {\n    define('keen', [], function(){ return f(); });\n  }\n  // CommonJS\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\n    module.exports = f();\n  }\n  // Global\n  var g = null;\n  if (typeof window !== 'undefined') {\n    g = window;\n  } else if (typeof global !== 'undefined') {\n    g = global;\n  } else if (typeof self !== 'undefined') {\n    g = self;\n  }\n  if (g) {\n    g.Keen = f();\n  }\n})(function() {\n  'use strict';\n\n  var Keen = require('./');\n  var extend = require('./utils/extend');\n\n  // ------------------------\n  // Methods\n  // ------------------------\n  extend(Keen.Client.prototype, require('./record-browser'));\n  // extend(Keen.Client.prototype, require('./defer'));\n  // extend(Keen.Client.prototype, require('./extend'));\n\n  // ------------------------\n  // Helpers\n  // ------------------------\n  extend(Keen.helpers, {\n    'getBrowserProfile'  : require('./helpers/getBrowserProfile'),\n    'getDatetimeIndex'   : require('./helpers/getDatetimeIndex'),\n    'getDomEventProfile' : require('./helpers/getDomEventProfile'),\n    'getDomNodePath'     : require('./helpers/getDomNodePath'),\n    'getScreenProfile'   : require('./helpers/getScreenProfile'),\n    'getUniqueId'        : require('./helpers/getUniqueId'),\n    'getWindowProfile'   : require('./helpers/getWindowProfile')\n  });\n\n  // ------------------------\n  // Utils\n  // ------------------------\n  extend(Keen.utils, {\n    'each'       : require('./utils/each'),\n    'extend'     : extend,\n    'parseParams': require('./utils/parseParams')\n  });\n\n  // ------------------------\n  // Process async queue\n  // ------------------------\n  // ...\n\n  module.exports = Keen;\n  return Keen;\n});\n","var getScreenProfile = require('./getScreenProfile'),\n    getWindowProfile = require('./getWindowProfile');\n\nfunction getBrowserProfile(){\n  return {\n    'cookies'  : ('undefined' !== typeof navigator.cookieEnabled) ? navigator.cookieEnabled : false,\n    'codeName' : navigator.appCodeName,\n    'language' : navigator.language,\n    'name'     : navigator.appName,\n    'online'   : navigator.onLine,\n    'platform' : navigator.platform,\n    'useragent': navigator.userAgent,\n    'version'  : navigator.appVersion,\n    'screen'   : getScreenProfile(),\n    'window'   : getWindowProfile()\n  }\n}\n\nmodule.exports = getBrowserProfile;\n","function getDateTimeIndex(input){\n  var date = input || new Date();\n  return {\n    'hour-of-day'  : date.getHours(),\n    'day-of-week'  : parseInt( 1 + date.getDay() ),\n    'day-of-month' : date.getDate(),\n    'month'        : parseInt( 1 + date.getMonth() ),\n    'year'         : date.getFullYear()\n  };\n}\n\nmodule.exports = getDateTimeIndex;\n","function getDomEventProfile(e){\n  if (!arguments.length) return {};\n  return {\n    'innerText': e.target.innerText,\n    'path': Keen.helpers.getDomPath(e.target).join(' > '),\n    'tagName': e.target.tagName,\n    'title': e.target.title\n  };\n}\n\nmodule.exports = getDomEventProfile;\n","/*!\n  via: http://stackoverflow.com/a/16742828/2511985\n  */\n\nfunction getDomNodePath(el){\n  if (!el.nodeName) return '';\n\n  var stack = [];\n  while ( el.parentNode != null ) {\n    // console.log(el.nodeName);\n    var sibCount = 0;\n    var sibIndex = 0;\n    for ( var i = 0; i < el.parentNode.childNodes.length; i++ ) {\n      var sib = el.parentNode.childNodes[i];\n      if ( sib.nodeName == el.nodeName ) {\n        if ( sib === el ) {\n          sibIndex = sibCount;\n        }\n        sibCount++;\n      }\n    }\n    if ( el.hasAttribute('id') && el.id != '' ) {\n      stack.unshift(el.nodeName.toLowerCase() + '#' + el.id);\n    } else if ( sibCount > 1 ) {\n      stack.unshift(el.nodeName.toLowerCase() + ':eq(' + sibIndex + ')');\n    } else {\n      stack.unshift(el.nodeName.toLowerCase());\n    }\n    el = el.parentNode;\n  }\n\n  return stack.slice(1); // removes the html element\n}\n\nmodule.exports = getDomNodePath;\n","function getScreenProfile(){\n  var keys, output;\n\n  if ('undefined' == typeof window || !window.screen) return {};\n\n  keys = ['height', 'width', 'colorDepth', 'pixelDepth', 'availHeight', 'availWidth'];\n  output = {};\n\n  for (var i = 0; i < keys.length; i++) {\n    output[keys[i]] = window.screen[keys[i]] ? window.screen[keys[i]] : null;\n  }\n\n  output.orientation = {\n    'angle' : window.screen.orientation ? window.screen.orientation['angle'] : 0,\n    'type'  : window.innerWidth > window.innerHeight ? 'landscape': 'portrait'\n  };\n\n  return output;\n}\n\nmodule.exports = getScreenProfile;\n","function getUniqueId(){\n\n}\n\nmodule.exports = getUniqueId;\n","function getWindowProfile(){\n  var body, html, output;\n\n  if ('undefined' == typeof document) return {};\n\n  body = document.body;\n  html = document.documentElement;\n\n  output = {\n    'height': window.innerHeight || null,\n    'width': window.innerWidth || null,\n    'scrollHeight': Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight ) || null\n  };\n\n  if (window.screen) {\n    output.ratio = {\n      'height': (window.screen.availHeight) ? parseFloat( (window.innerHeight/window.screen.availHeight).toFixed(2) ) : null,\n      'width': (window.screen.availWidth) ? parseFloat( (window.innerWidth/window.screen.availWidth).toFixed(2) ) : null\n    };\n  }\n\n  return output;\n}\n\nmodule.exports = getWindowProfile;\n","var Emitter = require('component-emitter');\n\nvar root = this;\nvar previousKeen = root.Keen;\n\nvar Keen = {\n  debug: false,\n  enabled: true,\n  helpers: {},\n  utils: {},\n  version: '0.0.0'\n};\n\n// Keen.loaded = true;\n\nKeen.Client = function(cfg){\n  this.configure(cfg);\n  Keen.emit('client', this);\n}\n\nKeen.Client.prototype.configure = function(cfg){\n  var config = cfg || {};\n  if (config['host']) {\n    config['host'].replace(/.*?:\\/\\//g, '');\n  }\n  if (config.protocol && config.protocol === 'auto') {\n    config['protocol'] = location.protocol.replace(/:/g, '');\n  }\n  this.config = {\n    projectId   : config.projectId,\n    writeKey    : config.writeKey,\n    // readKey     : config.readKey,\n    // masterKey   : config.masterKey,\n    requestType : config.requestType || 'jsonp',\n    host        : config['host']     || 'api.keen.io/3.0',\n    protocol    : config['protocol'] || 'https'\n    // globalProperties: null\n  };\n  if (Keen.debug) {\n    this.on('error', Keen.log);\n  }\n  this.emit('ready');\n};\n\nKeen.Client.prototype.projectId = function(str){\n  if (!arguments.length) return this.config.projectId;\n  this.config.projectId = (str ? String(str) : null);\n  return this;\n};\n\n// Keen.Client.prototype.masterKey = function(str){\n//   if (!arguments.length) return this.config.masterKey;\n//   this.config.masterKey = (str ? String(str) : null);\n//   return this;\n// };\n//\n// Keen.Client.prototype.readKey = function(str){\n//   if (!arguments.length) return this.config.readKey;\n//   this.config.readKey = (str ? String(str) : null);\n//   return this;\n// };\n\nKeen.Client.prototype.writeKey = function(str){\n  if (!arguments.length) return this.config.writeKey;\n  this.config.writeKey = (str ? String(str) : null);\n  return this;\n};\n\nKeen.Client.prototype.url = function(path){\n  if (!this.projectId()) {\n    this.emit('error', 'Keen.Client is missing a projectId property');\n    return;\n  }\n  return this.config.protocol + '://' + this.config.host + '/projects/' + this.projectId() + path;\n};\n\nEmitter(Keen);\nEmitter(Keen.Client.prototype);\n\nKeen.log = function(message) {\n  if (Keen.debug && typeof console == 'object') {\n    console.log('[Keen IO]', message);\n  }\n};\n\nKeen.noConflict = function(){\n  root.Keen = previousKeen;\n  return Keen;\n};\n\nmodule.exports = Keen;\n","var Keen = require('./index');\nvar base64 = require('./utils/base64');\nvar each = require('./utils/each');\n\nmodule.exports = {\n  'recordEvent': recordEvent,\n  'recordEvents': recordEvents\n};\n\nfunction recordEvent(eventCollection, eventBody, callback){\n  var self = this, url, data, cb, getRequestUrl;\n\n  url = self.url('/events/' + encodeURIComponent(eventCollection));\n  data = eventBody || {};\n  cb = callback;\n  // callback = null;\n\n  if (!checkValidation.call(self, cb)) {\n    return;\n  }\n\n  if (!eventCollection || typeof eventCollection !== 'string') {\n    handleValidationError.call(self, 'Collection name must be a string.', cb);\n    return;\n  }\n\n  // process extendEvent(s) transforms\n\n  // if (!sendEventData.call(this, url, data, cb)) {\n  //   handleValidationError.call(self, 'URL length exceeds current browser limit, and XHR is not supported.');\n  // }\n\n  getRequestUrl = makeGetRequestUrl.call(this, url, data);\n  if (getRequestUrl) {\n    switch (this.config.requestType) {\n      case 'xhr':\n        sendXhr.call(this, 'GET', getRequestUrl, null, null, cb);\n        break;\n      case 'beacon':\n        sendBeacon.call(this, getRequestUrl, cb);\n        break;\n      default:\n        sendJsonp.call(this, getRequestUrl, cb);\n        break;\n    }\n  }\n  else if (getXhr()) {\n    sendXhr.call(this, 'POST', url, data, cb);\n  }\n  else {\n    handleValidationError.call(self, 'URL length exceeds current browser limit, and XHR is not supported.');\n  }\n\n  callback = cb = null;\n}\n\nfunction recordEvents(eventsHash, callback){\n  var self = this, url, cb;\n\n  url = self.url('/events');\n  cb = callback;\n  callback = null;\n\n  if (!checkValidation.call(self, cb)) {\n    return;\n  }\n\n  if ('object' !== typeof eventsHash || eventsHash instanceof Array) {\n    handleValidationError.call(self, 'First argument must be an object', cb);\n    return;\n  }\n\n  if (arguments.length > 2) {\n    handleValidationError.call(self, 'Incorrect arguments provided to #addEvents method', cb);\n    return;\n  }\n\n  if (getXhr()) {\n    sendXhr.call(this, 'POST', url, eventsHash, cb);\n  }\n  else {\n    // each(eventsHash, function(eventArray, eventCollection){\n    //    ... send each individually?\n    // });\n  }\n\n  callback = cb = null;\n}\n\n\n// ------------------------------\n// Validation\n// ------------------------------\n\nfunction checkValidation(callback){\n  var cb = callback;\n  callback = null;\n\n  if (!Keen.enabled) {\n    handleValidationError.call(this, 'Keen.enabled is set to false.', cb);\n    return false;\n  }\n  if (!this.projectId()) {\n    handleValidationError.call(this, 'Keen.Client is missing a projectId property.', cb);\n    return false;\n  }\n  if (!this.writeKey()) {\n    handleValidationError.call(this, 'Keen.Client is missing a writeKey property.', cb);\n    return false;\n  }\n  return true;\n}\n\nfunction handleValidationError(message, cb){\n  var err = 'Event(s) not recorded: ' + message;\n  this.emit('error', err);\n  if (cb) {\n    cb.call(this, err, null);\n    cb = null;\n  }\n}\n\nfunction getUrlMaxLength(){\n  if ('undefined' !== typeof window) {\n    if (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') > 0) {\n      return 2000;\n    }\n  }\n  return 16000;\n}\n\nfunction makeGetRequestUrl(url, data){\n  url += '?';\n  url += serializeParams({\n    api_key  : this.writeKey(),\n    data     : base64.encode( JSON.stringify(data) ),\n    modified : new Date().getTime()\n  });\n  return ( url.length < getUrlMaxLength() ) ? url : false;\n}\n\nfunction serializeParams(object){\n  var query = [];\n  each(object, function(value, key){\n    if ('string' !== typeof value) {\n      value = JSON.stringify(value);\n    }\n    query.push(key + '=' + encodeURIComponent(value));\n  });\n  return query.join('&');\n}\n\n\n// ------------------------------\n// XHR Requests\n// ------------------------------\n\nfunction sendXhr(method, url, data, callback){\n  var self = this;\n  var payload;\n  var xhr = getXhr();\n  var cb = callback;\n  callback = null;\n\n  xhr.onreadystatechange = function() {\n    var response;\n    if (xhr.readyState == 4) {\n      if (xhr.status >= 200 && xhr.status < 300) {\n        try {\n          response = JSON.parse(xhr.responseText);\n        } catch (e) {\n          Keen.emit('error', 'Could not parse HTTP response: ' + xhr.responseText);\n          if (cb) {\n            cb.call(self, xhr, null);\n          }\n        }\n        if (cb && response) {\n          cb.call(self, null, response);\n        }\n      }\n      else {\n        Keen.emit('error', 'HTTP request failed.');\n        if (cb) {\n          cb.call(self, xhr, null);\n        }\n      }\n    }\n  };\n\n  xhr.open(method, url, true);\n  xhr.setRequestHeader('Authorization', self.writeKey());\n  xhr.setRequestHeader('Content-Type', 'application/json');\n\n  // each(headers, function(value, key){\n  //   xhr.setRequestHeader(key, value);\n  // });\n\n  if (data) {\n    payload = JSON.stringify(data);\n  }\n\n  if (method.toUpperCase() === 'GET') {\n    xhr.send();\n  }\n  if (method.toUpperCase() === 'POST') {\n    xhr.send(payload);\n  }\n\n}\n\nfunction getXhr() {\n  // yay, superagent!\n  var root = 'undefined' == typeof window ? this : window;\n  if (root.XMLHttpRequest && ('file:' != root.location.protocol || !root.ActiveXObject)) {\n    return new XMLHttpRequest;\n  } else {\n    try { return new ActiveXObject('Microsoft.XMLHTTP'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP'); } catch(e) {}\n  }\n  return false;\n};\n\n\n// ------------------------------\n// JSON-P Requests\n// ------------------------------\n\nfunction sendJsonp(url, callback){\n  var self = this,\n      cb = callback,\n      timestamp = new Date().getTime(),\n      script = document.createElement('script'),\n      parent = document.getElementsByTagName('head')[0],\n      callbackName = 'keenJSONPCallback',\n      loaded = false;\n\n  callback = null;\n\n  callbackName += timestamp;\n  while (callbackName in window) {\n    callbackName += 'a';\n  }\n  window[callbackName] = function(response) {\n    if (loaded === true) return;\n    loaded = true;\n    if (cb) {\n      cb.call(self, null, response);\n    }\n    cleanup();\n  };\n  script.src = url + '&jsonp=' + callbackName;\n  parent.appendChild(script);\n\n  // for early IE w/ no onerror event\n  script.onreadystatechange = function() {\n    if (loaded === false && this.readyState === 'loaded') {\n      loaded = true;\n      handleError();\n      cleanup();\n    }\n  };\n  // non-ie, etc\n  script.onerror = function() {\n    // on IE9 both onerror and onreadystatechange are called\n    if (loaded === false) {\n      loaded = true;\n      handleError();\n      cleanup();\n    }\n  };\n\n  function handleError(){\n    if (cb) {\n      cb.call(self, 'An error occurred!', null);\n    }\n  }\n\n  function cleanup(){\n    window[callbackName] = undefined;\n    try {\n      delete window[callbackName];\n    } catch(e){};\n    parent.removeChild(script);\n  }\n\n}\n\n\n// ------------------------------\n// Image Beacon Requests\n// ------------------------------\n\nfunction sendBeacon(url, callback){\n  var self = this,\n      cb = callback,\n      img = document.createElement('img'),\n      loaded = false;\n\n  callback = null;\n\n  img.onload = function() {\n    loaded = true;\n    if ('naturalHeight' in this) {\n      if (this.naturalHeight + this.naturalWidth === 0) {\n        this.onerror();\n        return;\n      }\n    } else if (this.width + this.height === 0) {\n      this.onerror();\n      return;\n    }\n    if (cb) {\n      cb.call(self);\n    }\n  };\n  img.onerror = function() {\n    loaded = true;\n    if (cb) {\n      cb.call(self, 'An error occurred!', null);\n    }\n  };\n  img.src = url + '&c=clv1';\n}\n","module.exports = {\n  map: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n  encode: function (n) {\n    \"use strict\";\n    var o = \"\", i = 0, m = this.map, i1, i2, i3, e1, e2, e3, e4;\n    n = this.utf8.encode(n);\n    while (i < n.length) {\n      i1 = n.charCodeAt(i++); i2 = n.charCodeAt(i++); i3 = n.charCodeAt(i++);\n      e1 = (i1 >> 2); e2 = (((i1 & 3) << 4) | (i2 >> 4)); e3 = (isNaN(i2) ? 64 : ((i2 & 15) << 2) | (i3 >> 6));\n      e4 = (isNaN(i2) || isNaN(i3)) ? 64 : i3 & 63;\n      o = o + m.charAt(e1) + m.charAt(e2) + m.charAt(e3) + m.charAt(e4);\n    } return o;\n  },\n  decode: function (n) {\n    \"use strict\";\n    var o = \"\", i = 0, m = this.map, cc = String.fromCharCode, e1, e2, e3, e4, c1, c2, c3;\n    n = n.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n    while (i < n.length) {\n      e1 = m.indexOf(n.charAt(i++)); e2 = m.indexOf(n.charAt(i++));\n      e3 = m.indexOf(n.charAt(i++)); e4 = m.indexOf(n.charAt(i++));\n      c1 = (e1 << 2) | (e2 >> 4); c2 = ((e2 & 15) << 4) | (e3 >> 2);\n      c3 = ((e3 & 3) << 6) | e4;\n      o = o + (cc(c1) + ((e3 != 64) ? cc(c2) : \"\")) + (((e4 != 64) ? cc(c3) : \"\"));\n    } return this.utf8.decode(o);\n  },\n  utf8: {\n    encode: function (n) {\n      \"use strict\";\n      var o = \"\", i = 0, cc = String.fromCharCode, c;\n      while (i < n.length) {\n        c = n.charCodeAt(i++); o = o + ((c < 128) ? cc(c) : ((c > 127) && (c < 2048)) ?\n        (cc((c >> 6) | 192) + cc((c & 63) | 128)) : (cc((c >> 12) | 224) + cc(((c >> 6) & 63) | 128) + cc((c & 63) | 128)));\n        } return o;\n    },\n    decode: function (n) {\n      \"use strict\";\n      var o = \"\", i = 0, cc = String.fromCharCode, c2, c;\n      while (i < n.length) {\n        c = n.charCodeAt(i);\n        o = o + ((c < 128) ? [cc(c), i++][0] : ((c > 191) && (c < 224)) ?\n        [cc(((c & 31) << 6) | ((c2 = n.charCodeAt(i + 1)) & 63)), (i += 2)][0] :\n        [cc(((c & 15) << 12) | (((c2 = n.charCodeAt(i + 1)) & 63) << 6) | ((c3 = n.charCodeAt(i + 2)) & 63)), (i += 3)][0]);\n      } return o;\n    }\n  }\n};\n","module.exports = function(o, cb, s){\n  var n;\n  if (!o){\n    return 0;\n  }\n  s = !s ? o : s;\n  if (o instanceof Array){\n    // Indexed arrays, needed for Safari\n    for (n=0; n<o.length; n++) {\n      if (cb.call(s, o[n], n, o) === false){\n        return 0;\n      }\n    }\n  } else {\n    // Hashtables\n    for (n in o){\n      if (o.hasOwnProperty(n)) {\n        if (cb.call(s, o[n], n, o) === false){\n          return 0;\n        }\n      }\n    }\n  }\n  return 1;\n};\n","module.exports = function(target){\n  for (var i = 1; i < arguments.length; i++) {\n    for (var prop in arguments[i]){\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n","function parseParams(str){\n  // via: http://stackoverflow.com/a/2880929/2511985\n  var urlParams = {},\n      match,\n      pl     = /\\+/g,  // Regex for replacing addition symbol with a space\n      search = /([^&=]+)=?([^&]*)/g,\n      decode = function (s) { return decodeURIComponent(s.replace(pl, \" \")); },\n      query  = str.split(\"?\")[1];\n\n  while (!!(match=search.exec(query))) {\n    urlParams[decode(match[1])] = decode(match[2]);\n  }\n  return urlParams;\n};\n\nmodule.exports = parseParams;\n","\n/**\n * Expose `Emitter`.\n */\n\nmodule.exports = Emitter;\n\n/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nfunction Emitter(obj) {\n  if (obj) return mixin(obj);\n};\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n  var args = [].slice.call(arguments, 1)\n    , callbacks = this._callbacks['$' + event];\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n"]}